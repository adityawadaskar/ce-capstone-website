<html>
<body style="margin-left: 41px; background-color: rgb(204, 204, 204);"
background="../_borders/paper3.gif">
<h1>Using <code>'makepart'</code></h1>
<p>
Other sections of this tutorial have described the vendor-supplied methods
for creating new symbols, cells, and parts.  The subject of this section is
a locally-developed shortcut known as <code>'makepart'</code>.  By using
this shortcut it becomes quite easy to build a new part from scratch in 
a single step.  If the required cell is not available in the
central library it must first be made.  In such cases part creation
actually requires two steps.
<p>
The <code>'makepart'</code> process associates an existing package footprint (i.e.
a "cell") with a new user-specified symbol by reading an ASCII file with the 
file extension <code>.mkpart</code>.  Everything needed for the
<code>makepart</code> process is contained in this single input file.
The output of <code>makepart</code> is an importable DXD symbol and an
importable part specification.   More detail on how to use these outputs
later.
<p>
The <code>makepart</code> input syntax is described below. 
With the exception of comment lines (which start with a "#" character)
the input consists of 6 header lines, an optional global net section,
and an optional no-connect section, all followed by a set of pin declaration lines
(this section begins with the <code>SIGNALS</code> keyword).
The parts of the <code>mkpart</code> file (and their relative order) are
depicted below.
<br>
<pre>
   _____________________________________
   |   Header section
   _____________________________________
   |   Global Nets section (optional)
   _____________________________________
   |   No-connects section (optional)
   |____________________________________
   |SIGNALS    <--- keyword
   |   Pin declarations section
   |____________________________________
   &lt;end of file&gt;
</pre>
We discuss each of these sections in the paragraphs that follow.
<h2>Header section</h2>
<ul>
<li>The first non-comment line specifies the total number of pins on the part.
It must be an integer and the value given must match the number of pins on
the footprint cell.</li>
<li>The second non-comment line specifies the rectangular shape to be used
for the symbol.  The format uses two integer numbers (nx ny) separated by
white space.  The units used are standard pin spacings.  For example, the
box for a typical symbol with 8 pins on the left side and 8 pins on the
right might be described by "5 10".  In this case the "5" (which sets the
width of the symbol box) is a bit arbitrary.   The height (in this example it is
10) allows space vertically for our 8 pins plus a little extra. 
Choose both of these large enough to allow the pin labels to fit neatly inside the box.</li>
<li>The third non-comment line gives the symbol name and its partition.
The format must be the partition name, then a colon (:), then the single-word
symbol name, following the DXD symbol naming restrictions.
For example: <code>PARTITION:SYMBOL</code></li>
<li>The fourth non-comment line gives the manufacturer's part number.
This is the identification used when the part is ordered.</li>
<li>The fifth non-comment line gives a cell description which is visible in
various reports generated by the librarian and other vendor-supplied tools.
<li>The sixth non-comment line specifies the cell name to be used. 
It must perfectly match a cell name found in the central library.
The cell must exist at the time the part description is imported.</li>
</ul>

<h2>Global nets section [optional]</h2>
<p>
It is often desirable to specify a part's power and ground connections so that they
get hooked up automatically (and invisibly).  The format begins with the global
net name followed by a colon (:), followed by a comma-separated list of pin identifiers. 
Each such global net specification must occur on a single line (even if it
gets very very long!).  An example global net specification is
<br>
<code>    GND:5,7,14,15</code>
<br>
which says that pins 5, 7, 14, and 15 are built-in connections to GND.  They do
not appear on the symbol and are therefore never seen on the schematic. 
Nevertheless, they are connected to the net named "<code>GND</code>" whenever
the part is instantiated.  Note that there may be zero or more global net
specifications.  If you choose to use this capability, be very careful to
get it right.  Invisible connections are a nice shortcut to make your
schematics cleaner and simpler but remember that connections do get made due to these
hidden built-in global nets.  It is imperative, especially because they are
power or ground connections, that you get these perfect!

<h2>No-connect section [optional]</h2>
<p>
As a cross-check to ensure correct symbol/cell mapping we require that all
pins be mentioned somewhere within the <code>.mkpart</code> file.  If a
given cell pin is not to be part of the symbol and if it is also not on 
any of the built-in global net specifications then its ID must appear
in a comma-separated list preceded by "<code>NC:</code>".

<h2>The SIGNALS section</h2>
<p>
The final and most important section of a <code>makepart</code> input file is
the signals section.  This section begins with a single line containing the
keyword "<code>SIGNALS</code>".  Following this keyword, each non-comment line must 
be of the form:
<br>
<code>    type  side  dir  pinID  label</code>
<br>
<ul>
<li>The <code>'type'</code> code is a single digit (0-2) that specifies
whether the signal is active-high (<code>0</code>), active-low (<code>1</code>),
or is not a signal at all but merely a request to skip a position along the
current symbol side (<code>2</code>).</li>
<li>The <code>'side'</code> designation is <code>L</code> (left),
<code>R</code>(right), <code>T</code>(top), or <code>B</code>(bottom).  It assigns
the current pin to the given side of the symbol under construction and advances that
side's next position point. The first pin on the L or R side is at the top with
subsequent pins moving down the respective edge.  The first pins on T or B sides
occur at the left with subsequent pins moving towards the right.</li>
<li>The <code>'dir'</code> (direction) must be one of the keywords
<code>IN</code>, <code>OUT</code>, or <code>BI</code>.  It
sets the pin type within the symbol appropriately.  This information is used later
in various usage-related rules checks.  Note that skip items (typecode = <code>2</code>)
do not require a direction code.</li>
<li>The <code>'pinID'</code> field is the physical location of the pin (normally an integer
pin number) within the cell. Some cells use pin identifiers that are non-numeric but these
are usually BGAs which cannot be used in ECE 189.
Note that skip items (typecode = <code>2</code>) do not have a <code>pinID</code> code.</li>
<li>The last field is the pin label.  This is the pin name that appears on the
schematic within the symbol. It is a good idea to use pin names that correspond directly
with those used on the manufacturer datasheets.  Sometimes abbreviations are necessary
to shorten manufacturer's labels when they are too longr. This often happens for pins that
can serve multiple purposes. For these, you may want to use a label that corresponds to
your intended usage and leave the other alternate labels off.  Labels can contain the
tilde (~) character which toggles the appearance of an overbar within the label.  This is normally
used to designate active-low symbols. In conjunction with a <code>typecode</code> of <code>1</code>
the tilde is automatically inserted by the Library Manager when your symbol is imported.  This
gives you an active-low bubble drawn on the symbol as well as an overbar in the label.  You
should never use a leading tilde on your own active-low labels since another tilde will
be inserted by the system upon symbol import.
Note that skip items (typecode = <code>2</code>) do not require a <code>label</code> field.</li>
</ul>
<h1>An example <code>mkpart</code> file</h1>
<p>
The lines below show the content of a file named <code>74act11374.mkpart</code>.
This part is an octal D-type flip-flop with common clock and active-low output enable.
The part has builtin 5V power connections on pin 18 and 19 (using the global
netname <code>P5V</code>) and builtin ground connections on pins 5, 6, 7, and 8
(using the global netname <code>GND</code>).  There are no unused pins and therefore
no <code>NC:</code> section is required.  The symbol, once imported, will be placed
in the "<code>SEB</code>" partition under the symbol name <code>74ACT11374</code>.
<pre>
    ###############################################################
    #
    # 74ACT11374DW --- Octal Latch
    #
    ###############################################################
    24
    6 9
    SEB:74ACT11374
    74ACT11374DW
    74ACT11374 octal latch with common CLK & active-low OE
    SO24W
    P5V:18,19
    GND:5,6,7,8
    SIGNALS
    1 L IN 24 OE     // will have an inversion bubble and an overbar
    0 L IN 13 CLK
    2 L ----------
    0 L IN 23 D1
    0 L IN 22 D2
    0 L IN 21 D3
    0 L IN 20 D4
    0 L IN 17 D5
    0 L IN 16 D6
    0 L IN 15 D7
    0 L IN 14 D8
    2 R ----------
    2 R ----------
    2 R ----------
    0 R BI 1 Q1
    0 R BI 2 Q2
    0 R BI 3 Q3
    0 R BI 4 Q4
    0 R BI 9 Q5
    0 R BI 10 Q6
    0 R BI 11 Q7
    0 R BI 12 Q8
</pre>
<p>
The created symbol looks like the graphic shown below.   Note the bubble designating
an active-low input on the <code>OE</code> pin (pin #24).  The <code>U?</code> at the
top of the symbol is the default reference designator.  This is a changeable field
that you will override with something like <code>U101</code> when the part is instantiated.
The order number and cell name attributes are visible at the bottom.  Several of the
other attributes (including the pin directions) are not visible by default. If you
wish to change the visibility (either to turn off the order number and/or cell name attributes
or to turn on some other attribute(s) ) then you would use the librarian's symbol editor.
The symbol editor an also be used to re-size the box, move pins around, or make other
simple edits to a symbol.  We recommend, however, that you keep your <code>.mkpart</code>
files up to date so that you can easily regenerate your symbols and parts if needed.
<br>
<br>
<img src="../_borders/symbol374.gif">
<br>
<p>
The referenced cell is a 20-pin "wide SOIC" (with custom cellname "<code>S024W</code>")
that looks like the graphic depicted below.  Note that the reference designator field
will be replaced by whatever you override the <code>U?</code> with.  The reference
designator appears both on the silkscreen and assembly plot layers.  As seen below,
we typically want the silkscreen reference designator to appear outside the part's
footprint so that it will be visible on the final assembled board.  The reference
designator that appears on the assembly plot, however, is normally positioned in the
center of the part's footprint, i.e. under the part, since at the time of assembly
the part will not yet be on the board. The assembly plot (a paper document) will be
used by the assembler to locate the correct spot for soldering the part to the board.
<br>
<br>
<img src="../_borders/SOIC024W.gif">
<br>

<h1>Running the <code>makepart</code> program</h1>
<p>
<code>Makepart</code> is a console application.  The executable resides on the
<code>\\smbdc\Classdocs</code> partition under the folder named <code>MPART</code>.
Running the program is easy.  Just follow the steps below:
<ul>
<li> Make sure that you have mounted the <code>Classdocs</code> partition using
a drive letter of your choice.  In this example we have chosen to use <code>Y:</code> . </li>
<li> Open a command window</li>
<li> Change the current working directory to the place where your input <code>mkpart</code>
file resides, presumably somewhere within your personal account directory.
Of course, you must have previously made this file using a text editor.</li>
<li>Run the program ----   <code>Y:\MPART\makepart  basename</code> where <code>basename</code>
is the portion of the filename that occurs before the dot.  This normally would correspond to
the name for the symbol you hope to generate.</li>
<li>After running <code>makepart</code> you should have two new files in the current
working directory. The file <code>basename.1</code> is the new symbol, ready to be imported
into your central library. The file <code>basename-part.txt</code> is the part specification,
in ASCII format.  Before it is ready to be imported by the librarian, there is one more
step to be performed.  The ASCII file <code>basename-part.txt</code> must be converted
(encrypted) by a program named "DataConvert".  Use the following command line:
<code>DataConvert -encrypt -i basename-part.txt -o basename.hkp</code>.
The <code>makepart</code> program should also produce a very short report
summarizing the number of pin declarations seen in the various categories.  It is critical
that the pins of all types sum to the total number of pins available on the cell.  If the
pin counts do not match then there is something wrong with your input file and you may
have trouble importing and/or using the resulting part.  We do not recommend any attempts to
use a symbol or a part until the pin sums match the number of pins available on the
corresponding cell.
</ul>

<h1>Importing your newly-created symbol</h1>
<p>Once you have run <code>makepart</code> and have your new symbol and part files ready,
the next step is to put them into your central library so that they can be used.  This step
is known as "importing" a symbol.  You must always import the symbol before attempting to
import the part description.  Why?  Because the part makes a correspondence between two
things (a symbol and a cell) and that correspondence cannot occur until both the symbol and
cell are known to the librarian.  Let's first look at the steps required to import a
new symbol.
<ul>
<li>Run the Library Manager.</li>
<li>Use the <code>File-&gt;Open</code> menu and select your project's private
central library.</li>
<li>Expand the Symbols section by clicking on the "+" box in the Librarian's
navigation pane.</li>
<li>Select the partition into which you want your new symbol imported or,
if you do not have the proper partition setup, right-click the Symbols section and
choose "New Partition...".</li>
<li>Right-click on your chosen partition and choose "Import Symbols..."</li>
<li>This should open a file selection dialog.  Navigate to your
<code>basename.1</code> file and choose <code>Open</code>.</li>
<li>When the import process completes, your new symbol should be part of your project's
central library.  Expand your partition by clicking on its "+" icon and then select
your new symbol to see it and/or edit it.</li>
</ul>
<p>Congratulations!  If you successfully followed the above procedure then you have imported
your first home-built symbol.  Note that there is another shortcut way to do this process.
Under the Librarian's <code>File</code> menu there is an <code>Import Symbols...</code> command
that can accomplish the same import actions as above.

<h1>Importing a <code>makepart</code>-generated part description</h1>
<p>Once you have used <code>makepart</code> to generate one or more new symbols and parts and
once the new symbol(s) has been imported to the central library, it is time to import the
new part description.  The steps for running the Librarian to accomplish this task are below:
<ul>
<li>Run the Librarian and select your project's private central library as you
did when you imported a new symbol above.</li>
<li>Go to <code>Tools-&gt;Library Services...</li>
<li>Select the "Parts" tab, with <code>Operation = Import</code> and
<code>Import from = Part data file</code></li>
<li>Click "..." on <code>Import from:</code> box to allow browsing.</li>
<li>Navigate to <code>basename.hkp</code> and click <code>Open</code>.</li>
<li>Select "Current partition" as the target partition to receive the new part.</li>
<li>Highlight part name in "Parts in ASCII file" box then press "&gt;" button
to move it into the "Parts to Import" box on the right.</li>
<li>Press "Apply" (in Copy mode), then "Close".</li>
</ul>
<p>Upon completing the above procedure, your new part should be available.  If there
are problems then you will be directed to a specific log file to see the details.
In such cases, you may need to seek help from the instructor or teaching assistant.
</body>
</html>
